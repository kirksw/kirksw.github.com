<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Python Packages in 2022 | MDS</title>
<meta name="keywords" content="">
<meta name="description" content="It&rsquo;s not suprise that new developers are confused when it comes to developing python libraries, there has been major changes over the years when it comes to how to work with python packages, and currently you may ask yourself what to use out of setup.py, setup.cfg and pyproject.toml. Before we look at these, it is important to first make sure we properly understand python modules and packages.
Python Modules In python a module is simply a file with a .">
<meta name="author" content="Kirk Sweeney">
<link rel="canonical" href="http://localhost:1313/posts/python/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css" integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/python/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:title" content="Python Packages in 2022" />
<meta property="og:description" content="It&rsquo;s not suprise that new developers are confused when it comes to developing python libraries, there has been major changes over the years when it comes to how to work with python packages, and currently you may ask yourself what to use out of setup.py, setup.cfg and pyproject.toml. Before we look at these, it is important to first make sure we properly understand python modules and packages.
Python Modules In python a module is simply a file with a ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/python/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-11T10:14:31+02:00" />
<meta property="article:modified_time" content="2022-09-11T10:14:31+02:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Python Packages in 2022"/>
<meta name="twitter:description" content="It&rsquo;s not suprise that new developers are confused when it comes to developing python libraries, there has been major changes over the years when it comes to how to work with python packages, and currently you may ask yourself what to use out of setup.py, setup.cfg and pyproject.toml. Before we look at these, it is important to first make sure we properly understand python modules and packages.
Python Modules In python a module is simply a file with a ."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Python Packages in 2022",
      "item": "http://localhost:1313/posts/python/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Python Packages in 2022",
  "name": "Python Packages in 2022",
  "description": "It\u0026rsquo;s not suprise that new developers are confused when it comes to developing python libraries, there has been major changes over the years when it comes to how to work with python packages, and currently you may ask yourself what to use out of setup.py, setup.cfg and pyproject.toml. Before we look at these, it is important to first make sure we properly understand python modules and packages.\nPython Modules In python a module is simply a file with a .",
  "keywords": [
    
  ],
  "articleBody": "It’s not suprise that new developers are confused when it comes to developing python libraries, there has been major changes over the years when it comes to how to work with python packages, and currently you may ask yourself what to use out of setup.py, setup.cfg and pyproject.toml. Before we look at these, it is important to first make sure we properly understand python modules and packages.\nPython Modules In python a module is simply a file with a .py extension which contains related code, which could be functions, classes, variables or etc.\nFor example lets define a function to greet a user:\ndef hello_name(name): print(f\"hello {name}\") To have this function store in a welcome module, we just need to save this code in a file named welcome.py.\nThis module can be used in one of two ways, either by importing the entire module, or importing a specific function. Never use from module import * as then you have no transparency on where certain functions/classes were imported from.\nimport welcome welcome.hello_name(\"bob\") # prints \"hello bob\" from welcome import hello_name hello_name(\"tim\") # prints \"hello tim\" Module introduce several benefits:\nImproved development Code re-uses Separate namespaces Finally a note on how python finds these modules. When import welcome is evaluated, the interpreter will search three locations.\nThe directory containing the input script (or current directly when no file is specified) PYTHONPATH (a list of directories with the same syntax as PATH) The installation-dependant default (by convention including a site-packages directory handled by the site module). Python Packages Python collection of modules intended to be installed and used together. When developing a large application you will probably end up with multiple modules which need to be organized, this is what a package does.\nIn python a package (or subpackage) is a folder containing one or more modules and a __init__.py file, which can be empty or contain some initialization code for the package.\nWe can import certain modules from any of these packages using dot notation. For example to import module_1 from the above package, we could use either of the following code snippets\nimport dairy_processing.calculations.density or\nfrom dairy_processing.calculations import density Note: We can also import specific functions as shown in the python modules section.\nPackaging flow Publishing a package requires a flow from the author’s source code to an end user’s Python environment. The steps to achieve this are:\nHave a source tree containing the package. This is typically a checkout from a version control system (VCS).\nPrepare a configuration file describing the package metadata (name, version and so forth) and how to create the build artifacts. For most packages, this will be a pyproject.toml file, maintained manually in the source tree.\nCreate build artifacts to be sent to the package distribution service (usually PyPI); these will normally be a source distribution (“sdist”) and one or more built distributions (“wheels”). These are made by a build tool using the configuration file from the previous step. Often there is just one generic wheel for a pure Python package.\nUpload the build artifacts to the package distribution service.\nAt that point, the package is present on the package distribution service. To use the package, end users must:\nDownload one of the package’s build artifacts from the package distribution service.\nInstall it in their Python environment, usually in its site-packages directory. This step may involve a build/compile step which, if needed, must be described by the package metadata.\nThese last 2 steps are typically performed by pip when an end user runs pip install.\nPyenv and Poetry to the rescue Poetry is a package which helps manage python packaging and dependency management. Pyenv allows you to manage multiple python versions on your computer. Installation of these tools is out of the scope of this guide.\nFirst we want to ensure our package is using the correct python version, this can be done by running pyenv local 3.10.5 from within the root directory (note: multiple versions can be selected using pyenv local 3.8.13 3.9.13 3.10.5 which would be required to run tox locally). Next we want to init a poetry project, which can be done using poetry init. Don’t worry about specifiying dependencies interactively as these can be added easily later, it’s important that the name is same as the name of the root package.\nIf you check the pyproject.toml file you should have something similar to below.\n[tool.poetry] name = \"rootpackage\" version = \"0.0.0\" description = \"test package\" authors = [\"Your Name (your.name@email.com)\"] [tool.poetry.dependencies] python = \"^3.10\" [tool.poetry.dev-dependencies] [build-system] requires = [\"poetry-core\u003e=1.0.0\"] build-backend = \"poetry.core.masonry.api\" You need to ensure that your existing package is in a subfolder ./rootpackage or ./src/rootpackage and that there is a __init__.py file present. If your package needs dependencies, these can be added with poetry add {depa} {depb}, development dependencies can be added using the -D flag poetry add -D pytest.\nYou can install the package and dependencies locally using poetry install, you can build the package using poetry build and you can publish the package using poetry publish.\nLibrary inconsistency.. In theory we can use pyproject.toml to define all our project metadata and configuration for different tooling, however reality is a little more complicated. Some tools fully support pyproject.toml, some have partial support and some don’t support it at all. In practice this means you may have some files like tox.ini and setup.cfg to contain certain configurations.\nflake8 Flake8 is one the current python packages which chooses to ignore the pyproject.toml file, meaning that the easiest way to setup the configuration is to add code snippet to one of either setup.cfg, tox.ini or .flake8\n[flake8] max-line-length = 88 extend-ignore = E203 per-file-ignores = __init__.py:F401 pytest pytest is a library which has implemented a bridge to the existing .ini configuration from version 6.0, in future they will fully utilize the rich TOML format and as such have reserved [tool.pytest] for this future use.\n# pyproject.toml [tool.pytest.ini_options] minversion = \"6.0\" addopts = \"-ra -q\" testpaths = [ \"tests\", \"integration\", ] tox Tox has partial support for pyproject.toml by offering to inline existing ini-style fomat under the tool.tox.legacy_tox_ini key as a multi-line string. An example of this is shown below.\n[tool.tox] legacy_tox_ini = \"\"\" [tox] envlist = py27,py36 [testenv] deps = pytest \u003e= 3.0.0, \u003c4 commands = pytest \"\"\" Typically it is easier to avoid this and use the tox.ini, tox are targetting full toml support with their new release.\nSummary Python has moved away from setup.py and setup.cfg to the new pyproject.toml file, most tools support pyproject.toml in some form, however don’t expect them all to be perfect, and there are some who just don’t support it yet. It is now easier than ever to setup a new package, but there is a lot of conflicting documentation due to this migration.\nPoetry is a powerful tool to assist with managing packaging, and we didn’t even scratch the surface here. In a future post I will walk through how this is actually setup and used in a DevOps pipeline along with all the common tooling (pypi, flake8, sphinx, coverage, pytest). There are also alternatives like hatch worth investigation, and also now more than ever, it is worth considering whether these tools are even required.\n",
  "wordCount" : "1201",
  "inLanguage": "en",
  "datePublished": "2022-09-11T10:14:31+02:00",
  "dateModified": "2022-09-11T10:14:31+02:00",
  "author":[{
    "@type": "Person",
    "name": "Kirk Sweeney"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/python/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "MDS",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="MDS (Alt + H)">MDS</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/kirksw" title="@Author">
                    <span>@Author</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Python Packages in 2022
    </h1>
    <div class="post-meta"><span title='2022-09-11 10:14:31 +0200 CEST'>2022-09-11</span>&nbsp;·&nbsp;Kirk Sweeney
      
      
    </div>
  </header> 
  <div class="post-content"><p>It&rsquo;s not suprise that new developers are confused when it comes to developing python libraries, there has been major changes over the years when it comes to how to work with python packages, and currently you may ask yourself what to use out of <code>setup.py</code>, <code>setup.cfg</code> and <code>pyproject.toml</code>. Before we look at these, it is important to first make sure we properly understand python modules and packages.</p>
<h3 id="python-modules">Python Modules<a hidden class="anchor" aria-hidden="true" href="#python-modules">#</a></h3>
<p>In python a module is simply a file with a <code>.py</code> extension which contains related code, which could be functions, classes, variables or etc.</p>
<p>For example lets define a function to greet a user:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hello_name</span>(name):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;hello </span><span style="color:#e6db74">{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><p>To have this function store in a welcome module, we just need to save this code in a file named <code>welcome.py</code>.</p>
<p>This module can be used in one of two ways, either by importing the entire module, or importing a specific function. Never use <code>from module import *</code> as then you have no transparency on where certain functions/classes were imported from.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> welcome
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>welcome<span style="color:#f92672">.</span>hello_name(<span style="color:#e6db74">&#34;bob&#34;</span>) <span style="color:#75715e"># prints &#34;hello bob&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> welcome <span style="color:#f92672">import</span> hello_name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>hello_name(<span style="color:#e6db74">&#34;tim&#34;</span>) <span style="color:#75715e"># prints &#34;hello tim&#34;</span>
</span></span></code></pre></div><p>Module introduce several benefits:</p>
<ul>
<li>Improved development</li>
<li>Code re-uses</li>
<li>Separate namespaces</li>
</ul>
<p>Finally a note on how python finds these modules. When <code>import welcome</code> is evaluated, the interpreter will search three locations.</p>
<ul>
<li>The directory containing the input script (or current directly when no file is specified)</li>
<li>PYTHONPATH (a list of directories with the same syntax as PATH)</li>
<li>The installation-dependant default (by convention including a site-packages directory handled by the site module).</li>
</ul>
<h3 id="python-packages">Python Packages<a hidden class="anchor" aria-hidden="true" href="#python-packages">#</a></h3>
<p>Python collection of modules intended to be installed and used together. When developing a large application you will probably end up with multiple modules which need to be organized, this is what a package does.</p>
<p>In python a package (or subpackage) is a folder containing one or more modules and a <code>__init__.py</code> file, which can be empty or contain some initialization code for the package.</p>
<p><img loading="lazy" src="images/dairy_processing_package.png" alt="python package hierachy"  />
</p>
<p>We can import certain modules from any of these packages using dot notation. For example to import module_1 from the above package, we could use either of the following code snippets</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> dairy_processing.calculations.density
</span></span></code></pre></div><p>or</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> dairy_processing.calculations <span style="color:#f92672">import</span> density
</span></span></code></pre></div><blockquote>
<p>Note: We can also import specific functions as shown in the python modules section.</p>
</blockquote>
<h3 id="packaging-flow">Packaging flow<a hidden class="anchor" aria-hidden="true" href="#packaging-flow">#</a></h3>
<p>Publishing a package requires a flow from the author’s source code to an end user’s Python environment. The steps to achieve this are:</p>
<ul>
<li>
<p>Have a source tree containing the package. This is typically a checkout from a version control system (VCS).</p>
</li>
<li>
<p>Prepare a configuration file describing the package metadata (name, version and so forth) and how to create the build artifacts. For most packages, this will be a pyproject.toml file, maintained manually in the source tree.</p>
</li>
<li>
<p>Create build artifacts to be sent to the package distribution service (usually PyPI); these will normally be a source distribution (“sdist”) and one or more built distributions (“wheels”). These are made by a build tool using the configuration file from the previous step. Often there is just one generic wheel for a pure Python package.</p>
</li>
<li>
<p>Upload the build artifacts to the package distribution service.</p>
</li>
</ul>
<p>At that point, the package is present on the package distribution service. To use the package, end users must:</p>
<ul>
<li>
<p>Download one of the package’s build artifacts from the package distribution service.</p>
</li>
<li>
<p>Install it in their Python environment, usually in its site-packages directory. This step may involve a build/compile step which, if needed, must be described by the package metadata.</p>
</li>
</ul>
<p>These last 2 steps are typically performed by pip when an end user runs pip install.</p>
<h3 id="pyenv-and-poetry-to-the-rescue">Pyenv and Poetry to the rescue<a hidden class="anchor" aria-hidden="true" href="#pyenv-and-poetry-to-the-rescue">#</a></h3>
<p>Poetry is a package which helps manage python packaging and dependency management. Pyenv allows you to manage multiple python versions on your computer. Installation of these tools is out of the scope of this guide.</p>
<p>First we want to ensure our package is using the correct python version, this can be done by running <code>pyenv local 3.10.5</code> from within the root directory (note: multiple versions can be selected using <code>pyenv local 3.8.13 3.9.13 3.10.5</code> which would be required to run tox locally). Next we want to init a poetry project, which can be done using <code>poetry init</code>. Don&rsquo;t worry about specifiying dependencies interactively as these can be added easily later,  it&rsquo;s important that the name is same as the name of the root package.</p>
<p>If you check the <code>pyproject.toml</code> file you should have something similar to below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span>[<span style="color:#a6e22e">tool</span>.<span style="color:#a6e22e">poetry</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">name</span> = <span style="color:#e6db74">&#34;rootpackage&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">version</span> = <span style="color:#e6db74">&#34;0.0.0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">description</span> = <span style="color:#e6db74">&#34;test package&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">authors</span> = [<span style="color:#e6db74">&#34;Your Name (your.name@email.com)&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#a6e22e">tool</span>.<span style="color:#a6e22e">poetry</span>.<span style="color:#a6e22e">dependencies</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">python</span> = <span style="color:#e6db74">&#34;^3.10&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#a6e22e">tool</span>.<span style="color:#a6e22e">poetry</span>.<span style="color:#a6e22e">dev-dependencies</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#a6e22e">build-system</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">requires</span> = [<span style="color:#e6db74">&#34;poetry-core&gt;=1.0.0&#34;</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">build-backend</span> = <span style="color:#e6db74">&#34;poetry.core.masonry.api&#34;</span>
</span></span></code></pre></div><p>You need to ensure that your existing package is in a subfolder <code>./rootpackage</code> or <code>./src/rootpackage</code> and that there is a <code>__init__.py</code> file present. If your package needs dependencies, these can be added with <code>poetry add {depa} {depb}</code>, development dependencies can be added using the -D flag <code>poetry add -D pytest</code>.</p>
<p>You can install the package and dependencies locally using <code>poetry install</code>, you can build the package using <code>poetry build</code> and you can publish the package using <code>poetry publish</code>.</p>
<h3 id="library-inconsistency">Library inconsistency..<a hidden class="anchor" aria-hidden="true" href="#library-inconsistency">#</a></h3>
<p>In theory we can use <code>pyproject.toml</code> to define all our project metadata and configuration for different tooling, however reality is a little more complicated. Some tools fully support <code>pyproject.toml</code>, some have partial support and some don&rsquo;t support it at all. In practice this means you may have some files like <code>tox.ini</code> and <code>setup.cfg</code> to contain certain configurations.</p>
<h4 id="flake8">flake8<a hidden class="anchor" aria-hidden="true" href="#flake8">#</a></h4>
<p>Flake8 is one the current python packages which chooses to ignore the <code>pyproject.toml</code> file, meaning that the easiest way to setup the configuration is to add code snippet to one of either <code>setup.cfg</code>, <code>tox.ini</code> or <code>.flake8</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[flake8]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">max-line-length</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">88</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">extend-ignore</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">E203</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">per-file-ignores</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">__init__.py:F401</span>
</span></span></code></pre></div><h4 id="pytest">pytest<a hidden class="anchor" aria-hidden="true" href="#pytest">#</a></h4>
<p>pytest is a library which has implemented a bridge to the existing <code>.ini</code> configuration from version 6.0, in future they will fully utilize the rich TOML format and as such have reserved <code>[tool.pytest]</code> for this future use.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span><span style="color:#75715e"># pyproject.toml</span>
</span></span><span style="display:flex;"><span>[<span style="color:#a6e22e">tool</span>.<span style="color:#a6e22e">pytest</span>.<span style="color:#a6e22e">ini_options</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">minversion</span> = <span style="color:#e6db74">&#34;6.0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">addopts</span> = <span style="color:#e6db74">&#34;-ra -q&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">testpaths</span> = [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;tests&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;integration&#34;</span>,
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><h4 id="tox">tox<a hidden class="anchor" aria-hidden="true" href="#tox">#</a></h4>
<p>Tox has partial support for <code>pyproject.toml</code> by offering to inline existing ini-style fomat under the <code>tool.tox.legacy_tox_ini</code> key as a multi-line string. An example of this is shown below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span>[<span style="color:#a6e22e">tool</span>.<span style="color:#a6e22e">tox</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">legacy_tox_ini</span> = <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[tox]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">envlist = py27,py36
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[testenv]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deps = pytest &gt;= 3.0.0, &lt;4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">commands = pytest
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span></code></pre></div><p>Typically it is easier to avoid this and use the <code>tox.ini</code>, tox are targetting full toml support with their new release.</p>
<h3 id="summary">Summary<a hidden class="anchor" aria-hidden="true" href="#summary">#</a></h3>
<p>Python has moved away from setup.py and setup.cfg to the new pyproject.toml file, most tools support <code>pyproject.toml</code> in some form, however don&rsquo;t expect them all to be perfect, and there are some who just don&rsquo;t support it yet. It is now easier than ever to setup a new package, but there is a lot of conflicting documentation due to this migration.</p>
<p>Poetry is a powerful tool to assist with managing packaging, and we didn&rsquo;t even scratch the surface here. In a future post I will walk through how this is actually setup and used in a DevOps pipeline along with all the common tooling (pypi, flake8, sphinx, coverage, pytest). There are also alternatives like hatch worth investigation, and also now more than ever, it is worth considering whether these tools are even required.</p>


  </div>

  <footer class="post-footer">
  </footer><div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "kswe" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>


    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:1313/">MDS</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
